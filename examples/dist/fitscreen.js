!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).FitScreenJS={})}(this,(function(t){"use strict";const e={PROPORTIONAL:"proportional",FULLSCREEN:"fullscreen"};function i(t){if(!t||"string"!=typeof t)return e.PROPORTIONAL;const i=t.toLowerCase();return Object.values(e).includes(i)?i:e.PROPORTIONAL}class s{constructor(t={}){this.options=t,this.container=null,this.content=null,this.designSize={width:0,height:0},this.currentScale=1,this.currentScaleX=1,this.currentScaleY=1,this.currentMode=t.mode||e.PROPORTIONAL,this.isInitialized=!1}setElements(t,e){this.container=t,this.content=e}setDesignSize(t,e){t>0&&e>0&&(this.designSize={width:t,height:e},this.refresh())}setMode(t){const e=this.currentMode;return this.currentMode=t,e!==this.currentMode&&this.isInitialized&&(this.refresh(),"function"==typeof this.options.onModeChange&&this.options.onModeChange(this.currentMode)),this.currentMode}getMode(){return this.currentMode}getScale(){return this.currentScale}calculateCurrentScale(){if(!this.container||!this.designSize.width||!this.designSize.height)return 1;const t=this.container.offsetWidth,i=this.container.offsetHeight;if(this.currentMode===e.FULLSCREEN){const e=function(t,e,i,s){return{scaleX:t/i,scaleY:e/s}}(t,i,this.designSize.width,this.designSize.height);this.currentScaleX=e.scaleX,this.currentScaleY=e.scaleY}return function(t,e,i,s,n=!1){const h=t/i,o=e/s;return n?Math.max(h,o):Math.min(h,o)}(t,i,this.designSize.width,this.designSize.height,this.currentMode===e.FULLSCREEN)}applyScaling(){this.container&&this.content&&(this.currentScale=this.calculateCurrentScale(),this.currentMode===e.FULLSCREEN?function(t,e,i,s){const{scaleContent:n=!0,backgroundColor:h=null,scaleX:o=null,scaleY:r=null,useTransform:l=!0,preserveChildStyles:a=!0}=s;if(t&&(t.style.position="relative",t.style.overflow="hidden",t.style.width="100%",t.style.height="100%",h&&(t.style.backgroundColor=h)),e&&n){const i=e.offsetWidth,s=e.offsetHeight;if(t.offsetWidth,t.offsetHeight,e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.margin="0",e.style.padding="0",l&&null!==o&&null!==r?(e.style.width=`${i}px`,e.style.height=`${s}px`,e.style.transformOrigin="top left",e.style.transform=`scaleX(${o}) scaleY(${r})`):(e.style.width="100%",e.style.height="100%",e.style.transform="none"),!a&&e.children.length>0){const t=e.children[0];t.style.width="100%",t.style.height="100%",t.style.backgroundImage&&(t.style.backgroundSize="cover")}}}(this.container,this.content,this.currentScale,{...this.options,scaleX:this.currentScaleX,scaleY:this.currentScaleY}):function(t,e,i,s){const{centerContent:n=!0,scaleContent:h=!0,backgroundColor:o=null}=s;if(t&&(t.style.position="relative",t.style.overflow="hidden",o&&(t.style.backgroundColor=o)),e&&h&&(e.style.position="absolute",e.style.transformOrigin="top left",e.style.transform=`scale(${i})`,n)){const s=e.offsetWidth*i,n=e.offsetHeight*i,h=t.offsetWidth,o=t.offsetHeight,r=Math.max(0,(h-s)/2),l=Math.max(0,(o-n)/2);e.style.left=`${r}px`,e.style.top=`${l}px`}}(this.container,this.content,this.currentScale,this.options),"function"==typeof this.options.onResize&&this.options.onResize(this.container.offsetWidth,this.container.offsetHeight,this.currentScale,this.currentMode===e.FULLSCREEN?{x:this.currentScaleX,y:this.currentScaleY}:null))}refresh(){this.container&&this.content&&(this.applyScaling(),this.isInitialized=!0)}}const n=1920,h=1080;function o(t,e,i){const{designWidth:s,designHeight:o,aspectRatio:r,autoDetect:l,detectedWidth:a,detectedHeight:c}=t;if(s&&o&&!isNaN(s)&&!isNaN(o)&&s>0&&o>0)return{width:s,height:o};if(r&&"number"==typeof r&&r>0){const t=e?{width:e.offsetWidth,height:e.offsetHeight}:{width:window.innerWidth,height:window.innerHeight};return t.width/t.height>r?{width:Math.round(t.height*r),height:t.height}:{width:t.width,height:Math.round(t.width/r)}}if(a&&c&&a>0&&c>0)return{width:a,height:c};if(l&&i){const t=function(t){if(!t)return{width:0,height:0};const e=window.getComputedStyle(t),i=parseFloat(e.width),s=parseFloat(e.height);if(!isNaN(i)&&!isNaN(s)&&i>0&&s>0)return{width:i,height:s};const n=t.style.width,h=t.style.height;if(n&&h){const t=parseFloat(n),e=parseFloat(h);if(!isNaN(t)&&!isNaN(e)&&t>0&&e>0)return{width:t,height:e}}const o=Array.from(t.children).reduce(((t,e)=>{const i=e.getBoundingClientRect();return t.right=Math.max(t.right,i.right),t.bottom=Math.max(t.bottom,i.bottom),t}),{right:0,bottom:0}),r=t.getBoundingClientRect();return{width:Math.max(i,o.right-r.left),height:Math.max(s,o.bottom-r.top)}}(i);if(t.width>0&&t.height>0)return t}if(e){const t={width:e.offsetWidth,height:e.offsetHeight};if(t.width>0&&t.height>0)return t}return{width:n,height:h}}class r{constructor(t={}){this.options=this._normalizeOptions(t),this.scaler=new s({...this.options,mode:i(this.options.mode)}),this.isInitialized=!1,this.isDestroyed=!1,this.options.container&&this.applyTo(this.options.container)}_normalizeOptions(t){const e={...t};return t.aspectRatio&&"string"==typeof t.aspectRatio&&(e.aspectRatio=function(t){if(!t||"string"!=typeof t)return null;const e=t.split(":");if(2!==e.length)return null;const i=parseFloat(e[0]),s=parseFloat(e[1]);return isNaN(i)||isNaN(s)||0===s?null:i/s}(t.aspectRatio)),e}applyTo(t){const s=(n=t)?"string"==typeof n?document.querySelector(n):n instanceof HTMLElement?n:null:null;var n;if(!s)return console.error("[FitScreenJS] 找不到容器元素"),this;s.style.width="100%",s.style.height="100%",s.style.overflow="hidden",s.style.position="relative";const h=s.children.length>0?s.children[0]:null;let r={width:0,height:0};if(h){const t=window.getComputedStyle(h);r.width=parseFloat(t.width)||h.offsetWidth,r.height=parseFloat(t.height)||h.offsetHeight,h.style.width&&h.style.height&&(r.width=parseFloat(h.style.width)||r.width,r.height=parseFloat(h.style.height)||r.height)}let l=s.querySelector(".fitscreen-content");if(!l){for(l=document.createElement("div"),l.className="fitscreen-content";s.firstChild;)l.appendChild(s.firstChild);s.appendChild(l)}i(this.options.mode)===e.FULLSCREEN?(l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.width="100%",l.style.height="100%",l.style.transform="none",r.width>0&&r.height>0&&(l.dataset.originalWidth=r.width,l.dataset.originalHeight=r.height)):r.width>0&&r.height>0&&(l.style.width=`${r.width}px`,l.style.height=`${r.height}px`),this.options.detectedWidth=r.width,this.options.detectedHeight=r.height,this.scaler.setElements(s,l);const a=o(this.options,s,l);return this.scaler.setDesignSize(a.width,a.height),this.isInitialized||(this._resizeHandler=function(t,e=100){let i;return function(...s){clearTimeout(i),i=setTimeout((()=>t.apply(this,s)),e)}}((()=>{this.isDestroyed||this.refresh()}),100),window.addEventListener("resize",this._resizeHandler),this.isInitialized=!0),this.refresh(),this}setMode(t){const s=this.getMode(),n=i(t);if(s!==n&&this.scaler.content){const t=this.scaler.content;if(n===e.FULLSCREEN)t.dataset.originalWidth||t.dataset.originalHeight||(t.dataset.originalWidth=t.style.width||t.offsetWidth,t.dataset.originalHeight=t.style.height||t.offsetHeight),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.transform="none";else if(s===e.FULLSCREEN){let e=this.scaler.designSize.width,i=this.scaler.designSize.height;t.dataset.originalWidth&&t.dataset.originalHeight&&(e=parseFloat(t.dataset.originalWidth),i=parseFloat(t.dataset.originalHeight)),e>0&&i>0&&(t.style.width=`${e}px`,t.style.height=`${i}px`)}}return this.scaler.options.preserveChildStyles=!0,this.scaler.setMode(n),this}getMode(){return this.scaler.getMode()}getScale(){return this.scaler.getScale()}setDesignSize(t,e){return this.scaler.setDesignSize(t,e),this}refresh(){return this.scaler.refresh(),this}destroy(){this.isInitialized&&!this.isDestroyed&&(window.removeEventListener("resize",this._resizeHandler),this.isDestroyed=!0)}}r.MODES=e,t.FitScreenJS=r,t.default=r,Object.defineProperty(t,"__esModule",{value:!0})}));
